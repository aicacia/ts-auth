import{e as o,u as f}from"./9Y3Zi9LS.js";import{l,T as c,d as T,e as s,f as p}from"./Dyl6cX5U.js";const r=l("token",null,{serializer:{parse(e){return T(JSON.parse(e))},stringify(e){return JSON.stringify(c(e))}}});o(()=>{f(()=>{p(r.value)})});const y={get validToken(){return!a(r.value)}};function a(e){return e?e.issuedAt.getTime()+e.expiresIn*1e3<=Date.now():!0}function g(e){return!e||!e.refreshTokenExpiresIn?!0:e.issuedAt.getTime()+e.refreshTokenExpiresIn*1e3<=Date.now()}async function m(e,u){return i(await s.token({grantType:"service-account",clientId:e,clientSecret:u}))}async function i(e){return r.value=e,e}async function k(e){return i(await s.token({grantType:"refresh-token",refreshToken:e}))}function n(){r.value=null}let t=!0;async function S(){try{return t&&(r.value&&a(r.value)&&(g(r.value)?n():await k(r.value.refreshToken)),t=!1),r.value}catch(e){return console.error(e),n(),null}}export{S as a,n as b,m as s,y as t};
