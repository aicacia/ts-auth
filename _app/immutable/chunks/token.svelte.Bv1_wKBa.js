import{T as l,b as f,s as r,c as a}from"./index.u_6ZM-6x.js";import{l as c}from"./api.svelte.B--TGwze.js";const n=c("token",null,{serializer:{parse(e){return l(JSON.parse(e))},stringify(e){return JSON.stringify(f(e))}}});function v(){return!s()}function s(){return n.value?n.value.issuedAt.getTime()+n.value.expiresIn*1e3<=Date.now():!0}function T(){return!n.value||!n.value.refreshTokenExpiresIn?!0:n.value.issuedAt.getTime()+n.value.refreshTokenExpiresIn*1e3<=Date.now()}async function h(e,o){return u(await a.token({grantType:"service-account",clientId:e,clientSecret:o}))}async function u(e){return r(e),n.value=e,e}async function k(e){return u(await a.token({grantType:"refresh-token",refreshToken:e}))}function t(){n.value=null,r(void 0)}let i=!0;async function y(){try{let e=n.value;return i&&(e&&s()&&(T()?(t(),e=null):e=await k(e.refreshToken)),i=!1),e&&r(e),e}catch(e){return console.error(e),t(),null}}export{t as a,v as i,h as s,y as t};
