import{e as u,u as f}from"./wkzzbBdv.js";import{T as l,b as c,c as s,s as T}from"./D5kayNry.js";import{l as p}from"./BIi6zqi6.js";const r=p("token",null,{serializer:{parse(e){return c(JSON.parse(e))},stringify(e){return JSON.stringify(l(e))}}});u(()=>{f(()=>{T(r.value)})});const m={get validToken(){return!i(r.value)}};function i(e){return e?e.issuedAt.getTime()+e.expiresIn*1e3<=Date.now():!0}function g(e){return!e||!e.refreshTokenExpiresIn?!0:e.issuedAt.getTime()+e.refreshTokenExpiresIn*1e3<=Date.now()}async function S(e,o){return a(await s.token({grantType:"service-account",clientId:e,clientSecret:o}))}async function a(e){return r.value=e,e}async function k(e){return a(await s.token({grantType:"refresh-token",refreshToken:e}))}function n(){r.value=null}let t=!0;async function x(){try{return t&&(r.value&&i(r.value)&&(g(r.value)?n():await k(r.value.refreshToken)),t=!1),r.value}catch(e){return console.error(e),n(),null}}export{x as a,n as b,S as s,m as t};
