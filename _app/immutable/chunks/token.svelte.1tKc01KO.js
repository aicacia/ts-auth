import{e as o,u as f}from"./runtime.XTayOKyQ.js";import{T as l,b as c,s as T,c as s}from"./index.B-XEKY0d.js";import{l as p}from"./api.svelte.DzjM_Kp1.js";const r=p("token",null,{serializer:{parse(e){return l(JSON.parse(e))},stringify(e){return JSON.stringify(c(e))}}});o(()=>{f(()=>{T(r.value)})});const m={get current(){return r.value},get validToken(){return!a(r.value)}};function a(e){return e?e.issuedAt.getTime()+e.expiresIn*1e3<=Date.now():!0}function g(e){return!e||!e.refreshTokenExpiresIn?!0:e.issuedAt.getTime()+e.refreshTokenExpiresIn*1e3<=Date.now()}async function S(e,u){return i(await s.token({grantType:"service-account",clientId:e,clientSecret:u}))}async function i(e){return r.value=e,e}async function v(e){return i(await s.token({grantType:"refresh-token",refreshToken:e}))}function n(){r.value=null}let t=!0;async function x(){try{return t&&(r.value&&a(r.value)&&(g(r.value)?n():await v(r.value.refreshToken)),t=!1),r.value}catch(e){return console.error(e),n(),null}}export{x as a,n as b,S as s,m as t};
