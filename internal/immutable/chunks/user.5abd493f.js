import{w as W,d as x}from"./index.35df97eb.js";import{w as E}from"./scheduler.1587348c.js";import{s as N,u as b,b as C}from"./index.480a3f55.js";const L={};function F(e){return e}function D(e){return e}function j(e,i,t={}){const a=typeof window<"u"&&typeof window.localStorage<"u",w=t.toJSON||D,v=t.fromJSON||F,_=t.setInitial||!0;function p(l,n){return a&&window.localStorage.setItem(l,JSON.stringify(w(n))),n}if(!L[e]){let o=function(f){p(e,f),s(f)};const l=W(i,f=>{const m=a?window.localStorage.getItem(e):null;if(m?f(v(JSON.parse(m))):_&&p(e,i),a){let c=function(d){d.key===e&&f(d.newValue?v(JSON.parse(d.newValue)):null)};return window.addEventListener("storage",c),()=>{window.removeEventListener("storage",c)}}}),{subscribe:n,set:s}=l;L[e]={set:o,update(f){o(f(E(l)))},subscribe:n}}return L[e]}const J=W(typeof navigator=="object"?navigator.onLine:!1),M=x(J,e=>e);function V(){return E(M)}function q(){J.set(!0)}function z(){J.set(!1)}window.addEventListener("online",q),window.addEventListener("offline",z);function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k={exports:{}};(function(e){var i=Object.prototype.hasOwnProperty,t="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(t=!1));function w(l,n,s){this.fn=l,this.context=n,this.once=s||!1}function v(l,n,s,o,f){if(typeof s!="function")throw new TypeError("The listener must be a function");var m=new w(s,o||l,f),c=t?t+n:n;return l._events[c]?l._events[c].fn?l._events[c]=[l._events[c],m]:l._events[c].push(m):(l._events[c]=m,l._eventsCount++),l}function _(l,n){--l._eventsCount===0?l._events=new a:delete l._events[n]}function p(){this._events=new a,this._eventsCount=0}p.prototype.eventNames=function(){var n=[],s,o;if(this._eventsCount===0)return n;for(o in s=this._events)i.call(s,o)&&n.push(t?o.slice(1):o);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(s)):n},p.prototype.listeners=function(n){var s=t?t+n:n,o=this._events[s];if(!o)return[];if(o.fn)return[o.fn];for(var f=0,m=o.length,c=new Array(m);f<m;f++)c[f]=o[f].fn;return c},p.prototype.listenerCount=function(n){var s=t?t+n:n,o=this._events[s];return o?o.fn?1:o.length:0},p.prototype.emit=function(n,s,o,f,m,c){var d=t?t+n:n;if(!this._events[d])return!1;var r=this._events[d],g=arguments.length,y,u;if(r.fn){switch(r.once&&this.removeListener(n,r.fn,void 0,!0),g){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,s),!0;case 3:return r.fn.call(r.context,s,o),!0;case 4:return r.fn.call(r.context,s,o,f),!0;case 5:return r.fn.call(r.context,s,o,f,m),!0;case 6:return r.fn.call(r.context,s,o,f,m,c),!0}for(u=1,y=new Array(g-1);u<g;u++)y[u-1]=arguments[u];r.fn.apply(r.context,y)}else{var U=r.length,O;for(u=0;u<U;u++)switch(r[u].once&&this.removeListener(n,r[u].fn,void 0,!0),g){case 1:r[u].fn.call(r[u].context);break;case 2:r[u].fn.call(r[u].context,s);break;case 3:r[u].fn.call(r[u].context,s,o);break;case 4:r[u].fn.call(r[u].context,s,o,f);break;default:if(!y)for(O=1,y=new Array(g-1);O<g;O++)y[O-1]=arguments[O];r[u].fn.apply(r[u].context,y)}}return!0},p.prototype.on=function(n,s,o){return v(this,n,s,o,!1)},p.prototype.once=function(n,s,o){return v(this,n,s,o,!0)},p.prototype.removeListener=function(n,s,o,f){var m=t?t+n:n;if(!this._events[m])return this;if(!s)return _(this,m),this;var c=this._events[m];if(c.fn)c.fn===s&&(!f||c.once)&&(!o||c.context===o)&&_(this,m);else{for(var d=0,r=[],g=c.length;d<g;d++)(c[d].fn!==s||f&&!c[d].once||o&&c[d].context!==o)&&r.push(c[d]);r.length?this._events[m]=r.length===1?r[0]:r:_(this,m)}return this},p.prototype.removeAllListeners=function(n){var s;return n?(s=t?t+n:n,this._events[s]&&_(this,s)):(this._events=new a,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=t,p.EventEmitter=p,e.exports=p})(k);var G=k.exports;const H=B(G),S=j("token",null),h=j("user",null),K=x(h,e=>e),Y=x(h,e=>!!e),Z=x(h,e=>(e==null?void 0:e.permissions.includes("admin"))===!0),I=new H;function $(){return!!E(K)&&!!E(S)}async function ee(e,i){const t=await C.signInWithPassword({application_id:1,username_or_email:e,password:i});return T(t)}async function te(e,i,t,a){const w=await C.signUpWithPassword({application_id:1,username:e,email:a,password:i,password_confirmation:t});return T(w)}async function T(e){N(e);const i=await b.current();return h.set(i),S.set(e),I.emit("user",i),i}function A(){h.set(null),S.set(null),N(void 0)}async function ne(e){await b.changeUsername({username:e}),h.update(i=>i?{...i,username:e}:null)}async function ie(e){await b.setPrimaryEmail(e),h.update(i=>{if(i){const t=i.emails.findIndex(a=>a.id===e);if(t!==-1){const a=i.emails.slice(),w=a[t];return i.email?a[t]=i.email:a.splice(t,1),{...i,email:w,emails:a}}}return i})}async function re(e){await b.deleteEmail(e),h.update(i=>{if(i){const t=i.emails.findIndex(a=>a.id===e);if(t!==-1){const a=i.emails.slice();return a.splice(t,1),{...i,emails:a}}}return i})}async function se(e,i){await C.confirmEmail(i),h.update(t=>{var a;if(t){if(((a=t.email)==null?void 0:a.id)===e)return{...t,email:{...t.email,confirmed:!0}};const w=t.emails.findIndex(v=>v.id===e);if(w!==-1){const v=t.emails.slice();return v[w]={...v[w],confirmed:!0},{...t,emails:v}}}return t})}async function oe(e){const i=await b.createEmail({email:e});h.update(t=>{if(t){const a=t.emails.slice();return a.push(i),{...t,emails:a}}return t})}let P=!0;async function ae(){try{let e=E(h);if(P){if(V()){const i=E(S);i?(N(i),e=await b.current(),h.set(e),I.emit("user",e)):(A(),e=null)}else e&&I.emit("user",e);P=!1}return e}catch(e){return console.error(e),A(),null}}export{H as E,Z as a,A as b,ie as c,re as d,se as e,oe as f,ae as g,ne as h,$ as i,ee as j,te as k,j as l,Y as s,K as u};
