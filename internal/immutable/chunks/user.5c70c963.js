import{w as D,d as L}from"./index.35df97eb.js";import{w as b}from"./scheduler.1587348c.js";import{s as R,u as S,b as U}from"./index.aac00523.js";const W={};function Q(n){return n}function Z(n){return n}function z(n,e,t={}){const r=typeof window<"u"&&typeof window.localStorage<"u",s=t.toJSON||Z,p=t.fromJSON||Q,k=t.setInitial||!0;function x(h,i){return r&&window.localStorage.setItem(h,JSON.stringify(s(i))),i}if(!W[n]){let l=function(f){x(n,f),a(f)};const h=D(e,f=>{const m=r?window.localStorage.getItem(n):null;if(m?f(p(JSON.parse(m))):k&&x(n,e),r){let c=function(_){_.key===n&&f(_.newValue?p(JSON.parse(_.newValue)):null)};return window.addEventListener("storage",c),()=>{window.removeEventListener("storage",c)}}}),{subscribe:i,set:a}=h;W[n]={set:l,update(f){l(f(b(h)))},subscribe:i}}return W[n]}function Y(n,e){return n[0]=(e&4278190080)>>24,n[1]=(e&16711680)>>16,n[2]=(e&65280)>>8,n[3]=e&255,n}const g=Math.pow(2,31)-1|0,C={},O={};class F{constructor(e,t){if(e!==C)throw new TypeError("Options can only be created with the some or none functions");this._value=t}static some(e){return v(e)}static none(){return w()}static from(e){return e!=null?v(e):w()}static fromJSON(e){return F.from(e)}isNone(){return this._value===O}isSome(){return!this.isNone()}expect(e){if(this.isSome())return this._value;throw new Error(typeof e=="function"?e():e)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(e){return this.isSome()?this._value:e}unwrapOrElse(e){return this.isSome()?this._value:e()}map(e){return this.isSome()?v(e(this._value)):w()}mapOr(e,t){return this.isSome()?v(e(this._value)):v(t)}mapOrElse(e,t){return this.isSome()?v(e(this._value)):v(t())}flatMap(e){return this.isSome()?e(this._value):w()}flatMapOr(e,t){return this.isSome()?e(this._value):t}flatMapOrElse(e,t){return this.isSome()?e(this._value):t()}and(e){return this.isSome()?e:w()}andThen(e){return this.isSome()?e(this._value):w()}or(e){return this.isNone()?e:this}orElse(e){return this.isNone()?e():this}xor(e){const t=this.isSome(),r=e.isSome();return t&&!r?this:!t&&r?e:w()}filter(e){return this.isSome()&&e(this._value)?this:w()}getOrInsert(e){return this.isNone()&&(this._value=e),this}getOrInsertWith(e){return this.isNone()&&(this._value=e()),this}clear(){return this._value=O,this}take(){if(this.isSome()){const e=this._value;return this._value=O,v(e)}else return w()}from(e){return e!=null?this._value=e:this.clear(),this}replace(e){return this._value=e,this}ifSome(e,t){return this.isSome()?e(this._value):t&&t(),this}ifNone(e,t){return this.isNone()?e():t&&t(this._value),this}toJSON(){return this.unwrapOr(null)}toJS(){return this.unwrapOr(null)}[Symbol.iterator](){return new ee(this._value)}}class ee{constructor(e){this.value=e}next(){if(this.value===O)return{done:!0,value:void 0};{const e=this.value;return this.value=O,{done:!1,value:e}}}}const v=n=>new F(C,n),w=()=>new F(C,O);class u{constructor(e){this._index=0,this._iter=e}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){const e=this._iter.next();return e.done?e:{value:[e.value,this._index++]}}enumerate(){throw new Error("Enumerate was not imported!")}peekable(){throw new Error("Peekable was not imported!")}forEach(e){throw new Error("ForEach was not imported!")}map(e){throw new Error("Map was not imported!")}merge(e){throw new Error("Merge was not imported!")}concat(e){return this.merge(e)}filter(e){throw new Error("Filter was not imported!")}step(e){throw new Error("Step was not imported!")}skip(e){throw new Error("Skip was not imported!")}take(e){throw new Error("Take was not imported!")}toMap(e,t){throw new Error("ToMap was not imported!")}flatten(e){throw new Error("Flatten was not imported!")}unflatten(e){throw new Error("Unflatten was not imported!")}reverse(){throw new Error("Reverse was not imported!")}count(){return this.reduce(0,e=>e+1)}consume(){let e=this.next();for(;!e.done;)e=this.next();return this}toArray(){return this.reduce([],(e,t)=>(e.push(t),e))}join(e){return this.toArray().join(e)}indexOf(e){let t=this.next(),r=0;for(;!t.done;){if(t.value===e)return r;r++,t=this.next()}return-1}findIndex(e){let t=this.nextWithIndex();for(;!t.done;){const[r,s]=t.value;if(e(r,s))return s;t=this.nextWithIndex()}return-1}find(e){let t=this.nextWithIndex();for(;!t.done;){const[r,s]=t.value;if(e(r,s))return v(r);t=this.nextWithIndex()}return w()}findAll(e){return this.filter(e)}nth(e=0){let t=this.next();for(e<0&&(e=0);!t.done;){if(e--<=0)return v(t.value);t=this.next()}return w()}first(){return this.nth(0)}last(){let e=this.next();for(;!e.done;){const t=this.next();if(t.done)return v(e.value);e=t}return w()}any(e){return this.findIndex(e)!==-1}some(e){return this.any(e)}none(e){return this.findIndex(e)===-1}all(e){let t=this.nextWithIndex();for(;!t.done;){const[r,s]=t.value;if(!e(r,s))return!1;t=this.nextWithIndex()}return!0}reduce(e,t){let r=this.next();for(;!r.done;){const s=r.value;e=t(e,s,this._index-1),r=this.next()}return e}}function A(n){return n!=null?typeof n[Symbol.iterator]=="function"?new u(n[Symbol.iterator]()):typeof n.next=="function"?n instanceof u?n:new u(n):A(typeof n=="object"?Object.entries(n):[n]):A([])}class te extends u{constructor(e){super(e)}next(){const e=super.nextWithIndex();return e.done?e:{value:ne(e.value)}}}u.prototype.enumerate=function(){return new te(this)};function ne(n){const e=n[0],t=n;return t[0]=n[1],t[1]=e,t}const re=n=>n,se=n=>n;class ie extends u{constructor(e,t=re,r=se){super(e),this._map=([s,p])=>[t(s,p),r(s,p)]}toObject(){return this.reduce({},(e,t)=>(e[t[0]]=t[1],e))}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._map(e.value)}}}u.prototype.toMap=function(e,t){return new ie(this,e,t)};class oe extends u{constructor(e,t){super(e),this._fn=t}next(){let e=super.nextWithIndex();for(;!e.done;){const[t,r]=e.value;if(this._fn(t,r))return{done:!1,value:t};e=super.nextWithIndex()}return{done:!0,value:void 0}}}u.prototype.filter=function(e){return new oe(this,e)};class ue extends u{constructor(e,t){super(e),this._fn=([r,s])=>(t(r,s),r)}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._fn(e.value)}}}u.prototype.forEach=function(e){return new ue(this,e)};class ae extends u{constructor(e,t){super(e),this._fn=t}next(){const e=super.nextWithIndex();if(e.done)return e;{const[t,r]=e.value;return{done:!1,value:this._fn(t,r)}}}}u.prototype.map=function(e){return new ae(this,e)};class le extends u{constructor(e,t){super(e),this._other=t}next(){const e=super.next();return e.done?this._other.next():e}}u.prototype.merge=function(e){return new le(this,e)};class he extends u{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?v(this.peeked.shift()):w()}peek(e=0){if(e<this.peeked.length)return v(this.peeked[e]);{let t=this.peeked.length-e-1,r=super.next();for(;!r.done&&(this.peeked.push(r.value),!(--t<=0));)r=super.next();return r.done?w():v(r.value)}}next(){const e=this.unpeek();if(e.isSome())return{done:!1,value:e.unwrap()};const t=super.next();return t.done?t:{done:!1,value:t.value}}}u.prototype.peekable=function(){return new he(this)};class ce extends u{constructor(e){super(e),this.index=0,this.reversed=!1,this.values=[]}next(){if(!this.reversed){let e=super.next();for(;!e.done;)this.values.push(e),e=super.next();this.reversed=!0,this.index=this.values.length}return this.index===0?{done:!0,value:void 0}:(this.index-=1,this.values[this.index])}}u.prototype.reverse=function(){return new ce(this)};class fe extends u{constructor(e,t){super(e),this._skipped=0,this._skip=(t<=0?0:t)|0}next(){let e=super.next();for(;!e.done;)if(this._skipped<=this._skip)this._skipped+=1,e=super.next();else return e;return{done:!0,value:void 0}}}u.prototype.skip=function(n){return new fe(this,n)};class pe extends u{constructor(e,t){super(e),this._stepped=0,this._step=t<=0?1:t|0}next(){let e=super.next();for(;!e.done;)if(this._stepped<this._step)this._stepped+=1,e=super.next();else return this._stepped=0,e;return{done:!0,value:void 0}}}u.prototype.step=function(n){return new pe(this,n)};class de extends u{constructor(e,t){super(e),this._taken=0,this._count=(t<=0?0:t)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}u.prototype.take=function(e){return new de(this,e)};class xe extends u{constructor(e,t){super(e),this._fn=t}next(){return this._fn(this._iter)}}u.prototype.unflatten=function(e){return new xe(this,e)};class me extends u{constructor(e,t=1){super(e),this._current=void 0,this._depth=t}next(){if(this._current!==void 0){const e=this._current.next();if(e.done)this._current=void 0;else return e}return this._nextRecur()}_nextRecur(){const e=super.next();if(e.done)return e;if(this._depth>0){const t=A(e.value).flatten(this._depth-1),r=t.next();return r.done?this._nextRecur():(this._current=t,r)}else return e}}u.prototype.flatten=function(e=1){return new me(this,e)};class we extends u{constructor(e){super(e),this.rng=e}iter(){return new u(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class ve extends u{constructor(e,t=0,r=1){super(e),this.rng=e,this.min=t,this.max=r}iter(){return new u(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class _e extends u{constructor(e,t=0,r=g){super(e),this.rng=e,this.min=t|0,this.max=r|0}iter(){return new u(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const ye=new Uint8Array(4);class j{nextFloat(){return this.nextInt()/g}nextFloatInRange(e=0,t=1){return e+this.nextFloat()*(t-e)}nextIntInRange(e=0,t=g){return Math.round(this.nextFloatInRange(e,t))}shuffle(e){const t=e.length;for(let r=0;r<t;r++){const s=r+this.nextIntInRange(0,t-r-1),p=e[r];e[r]=e[s],e[s]=p}return e}fromArray(e){return e.length?v(e[this.nextIntInRange(0,e.length-1)]):w()}keyFromObject(e){return this.fromArray(Object.keys(e))}valueFromObject(e){return this.fromArray(Object.values(e))}fillBytes(e){const t=ye;for(let r=0,s=e.length;r<s;r++){const p=r%4;p===0&&Y(t,this.nextInt()),e[r]=t[p]}return e}[Symbol.iterator](){return this}iter(){return new u(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new we(this)}uniformFloat(e=0,t=1){return new ve(this,e,t)}uniformInt(e=0,t=g){return new _e(this,e,t)}}const G=typeof crypto<"u"&&typeof crypto.getRandomValues=="function",ge=new Uint32Array(1),Ee=new Uint8Array(4),H=G?()=>crypto.getRandomValues(ge)[0]%g:()=>Math.random()*g|0,Ie=G?n=>crypto.getRandomValues(Array.isArray(n)?new Uint8Array(n):n):n=>{const e=Ee;for(let t=0,r=n.length;t<r;t++){const s=t%4;s===0&&Y(e,H()),n[t]=e[s]}return n};class Se extends j{nextInt(){return H()}fillBytes(e){return Ie(e)}}class K extends j{constructor(e=423257940){super(),this.seed=e}setSeed(e=423257940){return this.seed=e,this}nextInt(){return this.seed=Math.imul(48271,this.seed)|0%g,this.seed&g}}const ke=new K;class J extends j{constructor(e,t,r,s){super(),this.x=423257940,this.y=2829571177,this.z=2541948421,this.w=289122235,this.set(e,t,r,s)}static fromSeed(e){return new J().setSeed(e)}setSeed(e){const t=ke.setSeed(e);return this.set(t.nextInt(),t.nextInt(),t.nextInt(),t.nextInt())}set(e=423257940,t=2829571177,r=2541948421,s=289122235){return this.x=e|0,this.y=t|0,this.z=r|0,this.w=s|0,this}nextInt(){const e=this.x,t=e^e<<11;this.x=this.y,this.y=this.z,this.z=this.w;const r=this.w;return this.w=r^r>>19^(t^t>>8),this.w}}new K;new J;const Oe=new Se;let be=Oe;function Ne(){return be.nextFloat()}function Ve(){return Ne()*g|0}function Te(n){const[,e]=n.split(".");return JSON.parse(atob(e))}const P=D(typeof navigator=="object"?navigator.onLine:!1),Ae=L(P,n=>n);function Re(){return b(Ae)}function Fe(){P.set(!0)}function We(){P.set(!1)}window.addEventListener("online",Fe),window.addEventListener("offline",We);function Me(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(h,i,a){this.fn=h,this.context=i,this.once=a||!1}function p(h,i,a,l,f){if(typeof a!="function")throw new TypeError("The listener must be a function");var m=new s(a,l||h,f),c=t?t+i:i;return h._events[c]?h._events[c].fn?h._events[c]=[h._events[c],m]:h._events[c].push(m):(h._events[c]=m,h._eventsCount++),h}function k(h,i){--h._eventsCount===0?h._events=new r:delete h._events[i]}function x(){this._events=new r,this._eventsCount=0}x.prototype.eventNames=function(){var i=[],a,l;if(this._eventsCount===0)return i;for(l in a=this._events)e.call(a,l)&&i.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(a)):i},x.prototype.listeners=function(i){var a=t?t+i:i,l=this._events[a];if(!l)return[];if(l.fn)return[l.fn];for(var f=0,m=l.length,c=new Array(m);f<m;f++)c[f]=l[f].fn;return c},x.prototype.listenerCount=function(i){var a=t?t+i:i,l=this._events[a];return l?l.fn?1:l.length:0},x.prototype.emit=function(i,a,l,f,m,c){var _=t?t+i:i;if(!this._events[_])return!1;var o=this._events[_],E=arguments.length,I,d;if(o.fn){switch(o.once&&this.removeListener(i,o.fn,void 0,!0),E){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,a),!0;case 3:return o.fn.call(o.context,a,l),!0;case 4:return o.fn.call(o.context,a,l,f),!0;case 5:return o.fn.call(o.context,a,l,f,m),!0;case 6:return o.fn.call(o.context,a,l,f,m,c),!0}for(d=1,I=new Array(E-1);d<E;d++)I[d-1]=arguments[d];o.fn.apply(o.context,I)}else{var q=o.length,N;for(d=0;d<q;d++)switch(o[d].once&&this.removeListener(i,o[d].fn,void 0,!0),E){case 1:o[d].fn.call(o[d].context);break;case 2:o[d].fn.call(o[d].context,a);break;case 3:o[d].fn.call(o[d].context,a,l);break;case 4:o[d].fn.call(o[d].context,a,l,f);break;default:if(!I)for(N=1,I=new Array(E-1);N<E;N++)I[N-1]=arguments[N];o[d].fn.apply(o[d].context,I)}}return!0},x.prototype.on=function(i,a,l){return p(this,i,a,l,!1)},x.prototype.once=function(i,a,l){return p(this,i,a,l,!0)},x.prototype.removeListener=function(i,a,l,f){var m=t?t+i:i;if(!this._events[m])return this;if(!a)return k(this,m),this;var c=this._events[m];if(c.fn)c.fn===a&&(!f||c.once)&&(!l||c.context===l)&&k(this,m);else{for(var _=0,o=[],E=c.length;_<E;_++)(c[_].fn!==a||f&&!c[_].once||l&&c[_].context!==l)&&o.push(c[_]);o.length?this._events[m]=o.length===1?o[0]:o:k(this,m)}return this},x.prototype.removeAllListeners=function(i){var a;return i?(a=t?t+i:i,this._events[a]&&k(this,a)):(this._events=new r,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=t,x.EventEmitter=x,n.exports=x})(X);var Le=X.exports;const Ue=Me(Le),T=z("token",null),y=z("user",null),Ce=L(y,n=>n),De=L(y,n=>!!n),M=new Ue;function ze(){return!!b(Ce)&&!!b(T)}async function Ye(n,e){const t=await U.signInWithPassword({application_id:1,username_or_email:n,password:e});return $(t)}async function Ge(n,e,t,r){const s=await U.signUpWithPassword({application_id:1,username:n,email:r,password:e,password_confirmation:t});return $(s)}async function $(n){R(n);const e=await S.current();return y.set(e),T.set(n),M.emit("user",e),e}function B(){y.set(null),T.set(null),R(void 0)}async function je(){const n=await S.refreshToken();return R(n),T.set(n),n}async function He(n){await S.changeUsername({username:n}),y.update(e=>e?{...e,username:n}:null)}async function Ke(n){await S.setPrimaryEmail(n),y.update(e=>{if(e){const t=e.emails.findIndex(r=>r.id===n);if(t!==-1){const r=e.emails.slice(),s=r[t];return e.email?r[t]=e.email:r.splice(t,1),{...e,email:s,emails:r}}}return e})}async function Xe(n){await S.deleteEmail(n),y.update(e=>{if(e){const t=e.emails.findIndex(r=>r.id===n);if(t!==-1){const r=e.emails.slice();return r.splice(t,1),{...e,emails:r}}}return e})}async function $e(n,e){await U.confirmEmail(e),y.update(t=>{var r;if(t){if(((r=t.email)==null?void 0:r.id)===n)return{...t,email:{...t.email,confirmed:!0}};const s=t.emails.findIndex(p=>p.id===n);if(s!==-1){const p=t.emails.slice();return p[s]={...p[s],confirmed:!0},{...t,emails:p}}}return t})}async function qe(n){const e=await S.createEmail({email:n});y.update(t=>{if(t){const r=t.emails.slice();return r.push(e),{...t,emails:r}}return t})}let V=!0;async function Qe(){try{let n=b(y);if(V){if(Re()){const e=b(T);if(e){R(e),n=await S.current(),y.set(n);const t=Te(e),r=t.exp-t.iat,s=t.exp-Date.now()*.001;(r-s)/r>.5&&je(),M.emit("user",n)}else B(),n=null}else n&&M.emit("user",n);V=!1}return n}catch(n){return console.error(n),B(),null}}export{Ue as E,B as a,Ke as b,Ve as c,Xe as d,$e as e,qe as f,Qe as g,He as h,ze as i,Ye as j,Ge as k,z as l,De as s,Ce as u};
